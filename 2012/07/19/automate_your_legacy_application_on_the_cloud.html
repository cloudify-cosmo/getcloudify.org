<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>	
	<title>Cloudify - Automate Your Application on the Cloud with Cloudify Custom Commands</title>
	<script src="//cdn.optimizely.com/js/59503762.js"></script>
	<link rel="stylesheet" href="/css/template.css" type="text/css"/>	
	<link rel="canonical" href="http://www.cloudifysource.org/2012/07/19/automate_your_legacy_application_on_the_cloud.html"/>	
	<link rel="stylesheet" href="/css/jquery-ui-1.8.17.custom.css" type="text/css" media="all"/>
	<link rel="stylesheet" type="text/css" href="/scripts/prettify/prettify.css">	
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
	<script type="text/javascript" src="/scripts/jquery-1.6.4.js"></script>
	<script type="text/javascript" src="/scripts/search.js"></script>
	<script type="text/javascript" src="/scripts/jquery-ui-1.8.17.custom.min.js"></script>
	<script type="text/javascript" src="/scripts/jquery.prettyPhoto.js"></script>
	<script type="text/javascript" src="/scripts/prettify/prettify.js"></script>
	<script type="text/javascript" src="/scripts/version.data.js"></script>
	<script type="text/javascript" src="/scripts/version.js"></script>
	<script type="text/javascript">
	window.onload = function () {
		$('body').addClass("bodyClass");	
 	}
	
	$(function(){ 
		$("a.youtube").YouTubePopup({ hideTitleBar: true });
		$("div.expand").hide();
		
		
		$("li.expandBtn").click(function(){	
			$(this).next("div.expand").slideToggle(500);
			if($(this).html()=="More..."){
				$(this).html("Less...");	
			}else{
				$(this).html("More...");
			}
		});
		
	   /* ------------- added by Yaron/modified by Shlomo ------------ */
		$("#closeBut").parent().hide();
		$("#required").prev().hide();
		$("#required").hide();
		$("#required").next().hide();
		$("#values").hide();
		$("span.pln, span.kwd").css("cursor","pointer");
		$("span.pln, span.kwd").hover(function(eventObject){
			$(this).css("background-color","#CECECE");
			var currKey = $(eventObject.currentTarget).text().trim();
			if (currKey == "name") {
				var prevKey = $(eventObject.currentTarget).prev().prev("span.pln").text().trim();
					currKey = prevKey + "_" + currKey;
			}
			if (messages[currKey]) {
				var tooltip = $(".overlay"),
					position = $(eventObject.currentTarget).offset();
				$("#desc",tooltip).text(messages[currKey]);
				tooltip.show().offset({ top: position.top + tooltip.scrollTop() - 50, left: position.left + 100});
				$("#tipImg").position();
			}}, function(){
				$(".overlay").offset({top:0,left:0}).hide();
				$(this).css("background-color","transparent");
		});
	});
	
	</script>
	
		
	
	<script type="text/javascript" src="/scripts/cloudify_default.js"></script>
	<script type="text/javascript">

   var _gaq = _gaq || [];
   _gaq.push(['_setAccount', 'UA-31930048-1']);
   _gaq.push(['_trackPageview']);

   (function() {
	   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();

</script>
	<script type="text/javascript">
 var _gauges = _gauges || [];
(function() {
		var t   = document.createElement('script');
		t.type  = 'text/javascript';
		t.async = true;
		t.id    = 'gauges-tracker';
		t.setAttribute('data-site-id', '4fd5058b613f5d712200004f');
		t.src = '//secure.gaug.es/track.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(t, s);
})();
</script> 
</head>
<body>
<a class="fork-guide" target="_blank" href="https://github.com/CloudifySource/cloudify"></a>
<div class="WrapperBg">    
    <div class="Wrapper">
        <div class="header">
    <a class="logo" href="/"></a>
    <div class="clear"></div>
            <div class="topMenu">
                <ul class="_topmenu">
                    <li class="topmenuli"><a class="bgMenu1" href="http://forums.cloudifysource.org/forums"><span class="title1">Discuss & Suggest</span><span class="title2">Support Forums</span></a></li>
                    <li class="sep"></li>
                    <li class="topmenuli"><a class="bgMenu2" href="/guide/2.1/qsg/quick_start_guide"><span class="title1">Learn</span><span class="title2">Knowledge Base</span></a></li>
                    <li class="sep"></li>
                    <li class="topmenuli"><a class="bgMenu3" href="/participate"><span class="title1">Participate</span><span class="title2">Events & Webinars</span></a></li>
                    <li class="sep"></li>
                    <li class="topmenuli"><a class="bgMenu4" href="/blog"><span class="title1">Read</span><span class="title2">Blog Posts & Updates</span></a></li>
                    <li class="sep"></li>
                    <li class="topmenuli"><a class="bgMenu5" href="/cloudifysourcetv"><span class="title1">Watch</span><span class="title2">Watch & Learn</span></a></li>
                    <li class="sep"></li>
                    <li class="topmenuli"><a class="bgMenu6" href="/guide/contribute/how_to"><span class="title1">Develop</span><span class="title2">Get Involved</span></a></li>

		</ul>
		<div class="clear"></div>
	</div>
</div>

<!-- Tooltip Container -->
<div class="overlay">
<div class="overlayFrame">
<div style="width:100%;height:25px;align:left;"><img src="/images/close.png" id="closeBut"/></div>
<div><span id="desc"></span><br/>
 <span id="required"></span><br/>
 <span id="values"></span>
 </div>
</div>
<img src="/images/box_edge.png" id="tipImg"/>  
</div>
<div class="clear"></div>
        <div class="contentWrap">            
			<div class="breadcrumbs">Home Page > Cloudify Blogs > Automate Your Application on the Cloud with Cloudify Custom Commands</div>
            <div class="clear"></div>

            <!--Search-->
			
            
 

<div class="learnFrom">
    <h2>Blog Posts and Updates</h2>

    <div class="searchWrap">
        <form id="searchForm" action="#" method="get">
            <input id="search" class="searchTxt" type="text" placeholder="Search..."/>
            <input id="goBtn" class="searchBtn" type="submit" value="Go"/>
        </form>
    </div>
</div>
 
<div class="hp-right-col">
 		<a class="hp-btn-getCloudify" href="/downloads/get_cloudify">Get Cloudify!</a>
</div>




			
            <div class="content">
                <div id="alTag_LeftBlog" class="left">
                    
                    <!--Event groups-->



<div class="leftContentBox blogLeft-topTitle">
	<h3>Recent Posts</h3>
</div>


<div class="leftContentBox blogLeftBox"> 
   
	<a href="/2012/08/01/putting_devops_paas_together_with_cloudify.html">Putting DevOps and PaaS together with Cloudify 
	 <img class="noMargin" src="/images/arrow-right-blue.png" /></a><br />
	<span class="date">August  1, 2012</span>  
	<br/><br/>
  
	<a href="/2012/07/19/automate_your_legacy_application_on_the_cloud.html">Automate Your Application on the Cloud with Cloudify Custom Commands 
	 <img class="noMargin" src="/images/arrow-right-blue.png" /></a><br />
	<span class="date">July 19, 2012</span>  
	<br/><br/>
  
	<a href="/2012/07/10/hi_cloudsters.html">What Kept Us Busy - A Cloudify Update 
	 <img class="noMargin" src="/images/arrow-right-blue.png" /></a><br />
	<span class="date">July 10, 2012</span>  
	<br/><br/>
		
</div>

               <!--start -->
                 <div class="leftContentBox blogLeft-topTitle blog-left-title2 tumblr">
                        <h3>CloudifySource on Tumblr</h3>
                 </div>   
                <div class="leftContentBox">                     
                <!-- start sw-rss-feed code --> 
                <script type="text/javascript"> 
                <!-- 
                rssfeed_url = new Array(); 
                rssfeed_url[0]="http://cloudifysource.tumblr.com/rss";  
                rssfeed_frame_width="230"; 
                rssfeed_frame_height="250"; 
                rssfeed_scroll="on"; 
                rssfeed_scroll_step="6"; 
                rssfeed_scroll_bar="off"; 
                rssfeed_target="_blank"; 
                rssfeed_font_size="11"; 
                rssfeed_font_face="Trebuchet MS,Helvetica,Arial,Sans-serif"; 
                rssfeed_border="off"; 
                rssfeed_css_url=""; 
                rssfeed_title="off"; 
                rssfeed_title_name=""; 
                rssfeed_title_bgcolor="#393939"; 
                rssfeed_title_color="#393939"; 
                rssfeed_title_bgimage="http://"; 
                rssfeed_footer="off"; 
                rssfeed_footer_name="rss feed"; 
                rssfeed_footer_bgcolor="#fff"; 
                rssfeed_footer_color="#333"; 
                rssfeed_footer_bgimage="http://"; 
                rssfeed_item_title_length="50"; 
                rssfeed_item_title_color="#246F96"; 
                rssfeed_item_bgcolor="#none"; 
                rssfeed_item_bgimage="http://"; 
                rssfeed_item_border_bottom="on"; 
                rssfeed_item_source_icon="off"; 
                rssfeed_item_date="off"; 
                rssfeed_item_description="on"; 
                rssfeed_item_description_length="120"; 
                rssfeed_item_description_color="#393939"; 
                rssfeed_item_description_link_color="#333"; 
                rssfeed_item_description_tag="off"; 
                rssfeed_no_items="0"; 
                rssfeed_cache = "f2f79ba4f12501d5f8454c1d22c042c4"; 
                //--> 
                </script> 
                <script type="text/javascript" src="http://feed.surfing-waves.com/js/rss-feed.js"></script> 
                <!-- end sw-rss-feed code -->
                </div>
<!--end-->


<div class="leftContentBox blogLeft-topTitle">
	<h3>Archived Posts</h3>
</div>

 <ul class="blog-archive-list">
 
 
	
	
	
	
	
	

	
<li><a href="/2012/08">August 2012</a> <span class="blue">(1)</span></li>

	

	
		
			
<li><a href="/2012/07">July 2012</a> <span class="blue">(4)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/06">June 2012</a> <span class="blue">(3)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/05">May 2012</a> <span class="blue">(5)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/03">March 2012</a> <span class="blue">(3)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/02">February 2012</a> <span class="blue">(1)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2012/01">January 2012</a> <span class="blue">(2)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
		
	

	
	
	
	
	
	

	

	
		

<li><a href="/2011/11">November 2011</a> <span class="blue">(1)</span></li>

		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2011/10">October 2011</a> <span class="blue">(1)</span></li>

			
		
	

	
	
	
	
	
	

	

	
		
			
<li><a href="/2011/09">September 2011</a> <span class="blue">(1)</span></li>

			
		
	

	
	
	
	
	
	

	

	

	





 
 </ul>

                </div>

                <!--Start left content -->

                <div id="resultsDiv" class="DocumentsWrap"></div>
                <div id="pageContent" class="DocumentsWrapRight">
                    <h1 class="pageTitle">Automate Your Application on the Cloud with Cloudify Custom Commands</h1>
					 
					  <span class="blogPostInfo">Posted By: <a href="#">Tamir Korem</a>  on July 19, 2012  
					  </span>
					  <br/><br/><br/>
					 
                    <h3>Your Application is Installed on a Cloud. Now What ?</h3>
<p>Ok, so you installed an application on a cloud and now you want to update it, replace your .war file, modify the DB schema etc.<br />
I guess, some of the following thoughts may run in your head : &#8220;Now I need to login to the VM on the cloud (via ssh)&#8221;, &#8220;Where&#8217;s my Key-Pair file? Was is pem or ppk?&#8221;, &#8220;Do I have permissions to change files on the cloud?&#8221;, &#8220;I wish there was a way I could automate this process&#8221;.</p>
<p>In this post, I will walk you through Cloudify&#8217;s Custom Commands Mechanism.</p>
<p><a href="http://www.cloudifysource.org/guide/2.1/developing/custom_commands" class="newwindow">Cloudify Custom Commands</a> enable admin users or third-party tools to remotely manage service instances, which is especially useful when remote service APIs aren&#8217;t available.<br />
They can also come in handy in cross-service manipulations, where one service manipulates another service in the application, thus enabling static applications to become much more dynamic without replacing the stack.</p>
<p>All you need to do is add a few lines to your recipe file and you&#8217;re good to go.</p>
<h3>How to Create Custom Commands</h3>
<p>Cloudify provides this mechanism by allowing you to describe Custom Commands using Groovy closures, external Groovy scripts, or external shell/batch scripts. <br />
The commands can be parameterized, and they can be invoked by using the Cloudify shell or automatically by the lifecycle event handlers when certain conditions are met.</p>
<p>You need to add a <code>customCommands</code> section in the main section of the recipe&#8217;s service file.<br />
The <code>customCommands</code> section should contain an array of custom commands and their descriptions.<br />
Each custom command must be in the following format (syntax):<br />
 <strong><code>"customCommandName"</code> : groovy closure code or a script to run</strong></p>
<p><br/>
The following code snippet demonstrates several general examples:</p>
<script src="https://gist.github.com/3089320.js?file=customCommands.groovy"></script><h3>Custom Commands Use Cases</h3>
<p>In general, custom commands can be very useful in any of the following:</p>
<ol>
	<li>Continuous deployment (e.g. updating a war file)</li>
	<li>Reconfiguration of services (e.g. changing a db schema, or apache load balancer configuration or re-running a chef-client)</li>
	<li>Triggering an arbitrary operation on the service (e.g. invoke a load command on the apacheLB)</li>
</ol>
<h3>How to Use It</h3>
<p>In order to invoke a custom command from the Cloudify shell, run the following command:<br />
  &nbsp;&nbsp;<strong><code>invoke serviceName customCommandName [param1] [param2] ... [paramN]</code></strong></p>
<p>Custom commands can also be invoked by another service as described in the following code snippet and in the examples below.</p>
<script src="https://gist.github.com/3135329.js?file=tomcatInvokingApacheLB.groovy"></script>
<h3>Examples:</h3>
<p>Here are some helpful custom commands that we have already implemented in our sample recipes:</p>
<h4>Example 1: Dynamically Updating Your Apache Load Balancer</h4>
<p>We added <a href="https://github.com/CloudifySource/cloudify-recipes/blob/master/services/apacheLB/README.md#registering-a-service-instance-to-the-apache-load-balancer" class="newwindow">two custom commands:</a> to the <a href="https://github.com/CloudifySource/cloudify-recipes/tree/master/services/apacheLB" class="newwindow">apacheLB</a> recipe: addNode and removeNode, which update the configuration of the apache load balancer module with new/removed nodes members.</p>
<p>Here&#8217;s the code snippet in the apacheLB-service.groovy :</p>
<script src="https://gist.github.com/3069771.js?file=addRemoveNode.groovy"></script><p>As you can see, in apacheLB-service.groovy, there are two custom commands: addNode and removeNode. You need to add a postStart lifecycle event to each service whose instances you want add to the load balancer configuration. You need to add a postStop lifecycle event to each service whose instances you want removed from the load balancer configuration.<br />
For example, these commands are invoked during the <code>postStart</code> and <code>postStop</code> <a href="http://www.cloudifysource.org/guide/2.1/developing/lifecycle_events" class="newwindow">lifecycle event handlers</a><br />
,of the tomcat service in the <a href="https://github.com/CloudifySource/cloudify-recipes/tree/master/apps/petclinic" class="newwindow">PetClinic Recipe</a>.</p>
<p>The following presentation illustrates how the Custom Commands Machanism works with Apache and tomcat, from the installation of the services to modifying the <code>apacheLB</code> configuration by invoking custom commands:</p>
<div style="width:684px" id="__ss_13575384"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/tamirko/custom-commands211" title="Automate Your Application on the Cloud" target="_blank">Automate Your Application on the Cloud</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/13575384?rel=0" width="684" height="557" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0" allowfullscreen></iframe> <div style="padding:5px 0 12px"> View more PowerPoint from <a href="http://www.slideshare.net/tamirko" target="_blank">tamirko</a> </div> </div>
<h4>Example 2: Testing Your Load Balancer Under Heavy Loads</h4>
<p>On every machine on which apache is installed, you will also find the <a href="http://httpd.apache.org/docs/2.0/programs/ab.html" class="newwindow">ab command</a> which is a server benchmarking tool provided with the Apache <span class="caps">HTTP</span> distribution.<br />
In the <code>apacheLB</code> recipe, you can find a <code>"load"</code> custom command that uses <code>ab</code>, thus enabling you to test your application under load, by using the recipe&#8217;s <a href="https://github.com/CloudifySource/cloudify-recipes/blob/master/services/apacheLB/README.md#load-testing" class="newwindow">load</a> custom command.</p>
<p>Here&#8217;s the <code>"load"</code> code snippet in apacheLB-service.groovy :</p>
<script src="https://gist.github.com/3069774.js?file=loadApache.groovy"></script><h4>Example 3: Updating Your Application</h4>
<p>Let&#8217;s say, you installed a tomcat web server and deployed your war file on it (with Cloudify). <br />
Now you have a newer version of the war file.</p>
<p>All you need to do is to run the following custom command:<br />
      &nbsp;&nbsp;<strong><code>invoke tomcat updateWar NEW_WARFILE_FULL_URL_PATH</code></strong></p>
<p>Here&#8217;s the <code>"update_war"</code> code snippet in <code>tomcat-service.groovy</code> :</p>
<script src="https://gist.github.com/3070817.js?file=update_war.groovy"></script><h3>Oh, And One More Thing</h3>
<p>As always with Cloudify, it works on every cloud and every OS: EC2, OpenStack, Rackspace you name it, Windows and Linux (Centos or Ubuntu).</p>
<p>So don&#8217;t hesitate to give a test drive and let us know what you think.</p>
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'cloudifysource'; // required: replace example with your forum shortname
    var disqus_identifier = '/2012/07/19/automate_your_legacy_application_on_the_cloud.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>

                <div class="clear"></div>
            </div>
        </div>

        <!--Start pagination -->

        <div class="clear"></div>

        <!--Start Footer -->

        <div class="footer">
    <!--<ul class="footerLeftMenu">
        <li class="footerli"><a href="#">About GigaSpaces</a></li>
        <li class="footerli"><a href="#">Contact Us</a></li>
    </ul> -->
    <ul class="footerRightMenu">
        <li class="footerli">Copyright Â© 2012 GigaSpaces. All rights reserved.</li>
        <li class="footerli"><a href="/about_us">About Us</a></li>
        <li class="footerli">|</li>
        <li class="footerli"><a href="/terms_of_use">Terms of Use</a></li>
        <li class="footerli">|</li>
        <li class="footerli"> <a href="/privacy_policy">Privacy Policy</a></li>
    </ul> 
    <ul class="footerSocialMenu">
        <li class="footerFb"><a href="https://www.facebook.com/GigaSpaces?sk=app_201742856511228"></a></li>
        <li class="footerRss"><a href="/atom.xml"></a></li>
        <!--<li class="footerMell"><a href="#"></a></li>-->
        <li class="footerTwitt"><a href="http://www.twitter.com/cloudifysource"></a></li>
        <li class="footerYt"><a href="http://www.youtube.com/cloudifysource"></a></li>
    </ul>
</div>

<script type="text/javascript">
window.AIConfig = {};
window.AIConfig.mailTextField = 'EMAIL';
window.AIConfig.accountId='cloudifysource';
document.write(unescape("%3Cscript src='http://test.activeinsight.net/trw.js' type='text/javascript'%3E%3C/script%3E"));
</script>

    </div>
    <!--End site wrapper -->


</div>
<!--End site bg top wrapper -->
</body>
</html>
